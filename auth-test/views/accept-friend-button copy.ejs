<% let backgroundColor = 'bg-slate-200';
  let textColor = 'text-black';
  let disabled = false;
  if(friendshipStatus === 'Accept friend') {
  backgroundColor = 'bg-slate-200';
  textColor = 'text-black';
} else if (friendshipStatus === '✓ Friend'){
  backgroundColor = 'bg-black';
  textColor = 'text-white';
  disabled = true;
} 
%>

<button data-friend-id="<%= friendId._id %>" id='<%= friendId._id %>' class="flex justify-center rounded-md <%= backgroundColor %> px-2 py-0.5 text-sm font-semibold leading-6 <%= textColor %> shadow-sm hover:bg-black hover:text-white focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-green-500 friend-button relative">
  <%= friendshipStatus %>
  <!-- Cancel friend request button -->
  <button data-friend-id="<%= friendId._id %>" class="cancel-friend-request-button hidden absolute top-0 right-0 bg-red-500 text-white px-2 py-1 rounded-md">Cancel Request</button>
</button>

<script>
  // Function to handle cancel friend request button visibility
  function handleCancelFriendRequestButtonVisibility(event) {
    const cancelBtn = event.target.querySelector('.cancel-friend-request-button');
    cancelBtn.style.display = event.type === 'mouseover' ? 'block' : 'none';
  }

  // Event listeners for showing/hiding cancel friend request button on hover
  const addFriendButtons = document.querySelectorAll('.friend-button');
  addFriendButtons.forEach(button => {
    button.addEventListener('mouseover', handleCancelFriendRequestButtonVisibility);
    button.addEventListener('mouseout', handleCancelFriendRequestButtonVisibility);
  });

  // Event listener for cancel friend request button click
  const cancelBtns = document.querySelectorAll('.cancel-friend-request-button');
  cancelBtns.forEach(btn => {
    btn.addEventListener('click', async function(event) {
      const friendId = btn.dataset.friendId;
      // Perform cancel friend request action
      const response = await fetch(`/profile/${friendId}/cancel-request`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ friendId })
      });
      
      if (response.ok) {
      // Update the UI based on the response
      const responseData = await response.json();

      if (responseData.message === 'Friend request sent') {
        document.getElementById('<%= friendId._id %>').textContent = 'Requested';
        document.getElementById('<%= friendId._id %>').classList.add('bg-black');
      } else if (responseData.message === 'Friend request accepted'){
        document.getElementById('<%= friendId._id %>').textContent = '✓ Friend';
        document.getElementById('<%= friendId._id %>').classList.remove('bg-slate-200');
        document.getElementById('<%= friendId._id %>').classList.add('bg-black');
        document.getElementById('<%= friendId._id %>').classList.add('text-white');
      }
    }
    });
  });
</script>